<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Platformer ‚Äî Muniverse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" />
  <style>
    .wrap{max-width:1000px;margin:32px auto;padding:0 16px}
    .head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .title{font-weight:800;letter-spacing:-.5px}
    .muted{color:#9aa0ad}
    canvas{
      width:100%;max-width:960px;aspect-ratio:16/9;
      background: radial-gradient(1200px 600px at 50% -20%, rgba(255,106,0,.18), transparent 60%), #0b0c12;
      border:1px solid #1f2130;border-radius:14px;display:block;margin:0 auto
    }
    .btn{padding:8px 12px;border-radius:10px;border:1px solid #2a2a32;background:#14151b;color:#fff;text-decoration:none}
    .btn-primary{background:#ff6a00;border-color:#ff6a00;color:#0e0f14;font-weight:700}
    .kbd{font:600 12px/1.2 ui-monospace, SFMono-Regular, Menlo, monospace;background:#1b1d2b;border:1px solid #2a2c3d;border-radius:6px;padding:2px 6px;margin:0 1px;color:#e6eafd}
  </style>
</head>
<body>
  <header class="topbar">
    <a class="logo" href="{{ url_for('onboarding') }}">üåç <span>Muniverse</span></a>
    <nav class="nav">
      <a href="{{ url_for('feed') }}">Home</a>
      <a href="{{ url_for('explore') }}">Explore</a>
      <a href="{{ url_for('conferences') }}">Conferences</a>
      <a href="{{ url_for('about') }}">About</a>
    </nav>
  </header>

  <main class="wrap">
    <div class="head">
      <h2 class="title">Mini Platformer</h2>
      <div class="muted">
        Move: <span class="kbd">‚Üê</span>/<span class="kbd">A</span> &nbsp;
        <span class="kbd">‚Üí</span>/<span class="kbd">D</span> &nbsp; ‚Ä¢ &nbsp;
        Jump: <span class="kbd">Space</span>
      </div>
      <a class="btn" href="{{ url_for('about') }}">Back</a>
    </div>

    <canvas id="game" width="960" height="540"></canvas>
  </main>

  <script>
  (() => {
    const cvs = document.getElementById('game');
    const ctx = cvs.getContext('2d');

    const W = cvs.width, H = cvs.height;
    const GRAV = 0.65;
    const FRICTION = 0.82;

    const keys = { left:false, right:false, jump:false };
    addEventListener('keydown', e => {
      if (['ArrowLeft','a','A'].includes(e.key)) keys.left=true;
      if (['ArrowRight','d','D'].includes(e.key)) keys.right=true;
      if (e.code === 'Space') keys.jump=true;
    });
    addEventListener('keyup', e => {
      if (['ArrowLeft','a','A'].includes(e.key)) keys.left=false;
      if (['ArrowRight','d','D'].includes(e.key)) keys.right=false;
      if (e.code === 'Space') keys.jump=false;
    });

    const player = {
      x: 60, y: H-100,
      w: 32, h: 42,
      vx: 0, vy: 0,
      speed: 0.9,
      jump: 12,
      grounded: false
    };

    // Simple level
    const platforms = [
      {x:0, y:H-40, w:W, h:40},             // floor
      {x:140, y:H-140, w:160, h:14},
      {x:350, y:H-230, w:140, h:14},
      {x:540, y:H-180, w:180, h:14},
      {x:780, y:H-260, w:140, h:14},
    ];
    const goal = { x: 880, y: H-300-24, w: 24, h: 24 }; // small ‚Äúgavel flag‚Äù

    let won = false;

    function reset() {
      player.x = 60; player.y = H-100; player.vx = 0; player.vy = 0;
      won = false;
    }

    function collide(ax, ay, aw, ah, bx, by, bw, bh) {
      return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
    }

    function step() {
      update();
      draw();
      requestAnimationFrame(step);
    }

    function update() {
      if (won) return;

      // Input
      if (keys.left)  player.vx -= player.speed;
      if (keys.right) player.vx += player.speed;

      player.vx *= FRICTION;
      player.vy += GRAV;

      // Position
      player.x += player.vx;
      player.y += player.vy;

      player.grounded = false;

      // Collision with platforms
      for (const p of platforms) {
        // Horizontal
        if (collide(player.x, player.y, player.w, player.h, p.x, p.y, p.w, p.h)) {
          // resolve vertical first
          if (player.y + player.h - player.vy <= p.y) {
            // landed on top
            player.y = p.y - player.h;
            player.vy = 0;
            player.grounded = true;
          } else if (player.y - player.vy >= p.y + p.h) {
            // hit from below
            player.y = p.y + p.h;
            player.vy = 0.5;
          } else if (player.x + player.w - player.vx <= p.x) {
            // hit left side
            player.x = p.x - player.w;
            player.vx = 0;
          } else if (player.x - player.vx >= p.x + p.w) {
            // hit right side
            player.x = p.x + p.w;
            player.vx = 0;
          }
        }
      }

      // Jump
      if (keys.jump && player.grounded) {
        player.vy = -player.jump;
        player.grounded = false;
      }

      // Bounds
      if (player.x < 0) player.x = 0;
      if (player.x + player.w > W) player.x = W - player.w;
      if (player.y > H + 200) reset(); // fell off

      // Win
      if (collide(player.x, player.y, player.w, player.h, goal.x, goal.y, goal.w, goal.h)) {
        won = true;
        setTimeout(()=>alert('Gavel secured! You win üèÅ'), 100);
      }
    }

    function drawBG() {
      ctx.fillStyle = '#0b0c12';
      ctx.fillRect(0,0,W,H);

      // subtle grid
      ctx.strokeStyle = 'rgba(255,106,0,.08)';
      ctx.lineWidth = 1;
      for (let x=0; x<W; x+=32){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke(); }
      for (let y=0; y<H; y+=32){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke(); }

      // title
      ctx.fillStyle = 'rgba(255,106,0,.15)';
      ctx.font = '700 36px Kanit, system-ui, sans-serif';
      ctx.textAlign = 'left';
      ctx.fillText('Muniverse Platformer', 24, 52);
    }

    function draw() {
      drawBG();

      // Platforms
      ctx.fillStyle = '#1f2130';
      for (const p of platforms) {
        ctx.fillRect(p.x, p.y, p.w, p.h);
        ctx.strokeStyle = 'rgba(255,106,0,.45)';
        ctx.strokeRect(p.x+.5, p.y+.5, p.w-1, p.h-1);
      }

      // Goal (little gavel flag)
      ctx.fillStyle = '#ff6a00';
      ctx.fillRect(goal.x, goal.y, goal.w, goal.h);
      ctx.fillStyle = '#222';
      ctx.fillRect(goal.x + goal.w - 6, goal.y - 16, 4, 16); // pole
      ctx.fillStyle = '#ff6a00';
      ctx.beginPath(); ctx.moveTo(goal.x + goal.w - 6, goal.y - 16);
      ctx.lineTo(goal.x + goal.w + 14, goal.y - 10);
      ctx.lineTo(goal.x + goal.w - 6, goal.y - 4);
      ctx.closePath(); ctx.fill();

      // Player
      ctx.fillStyle = '#ff6a00';
      roundRect(ctx, player.x, player.y, player.w, player.h, 8, true);

      if (won) {
        ctx.fillStyle = 'rgba(0,0,0,.5)';
        ctx.fillRect(0,0,W,H);
        ctx.fillStyle = '#fff';
        ctx.font = '700 32px Kanit, system-ui, sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Gavel secured! You win üèÅ', W/2, H/2);
      }
    }

    function roundRect(ctx, x, y, w, h, r, fill) {
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y,   x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x,   y+h, r);
      ctx.arcTo(x,   y+h, x,   y,   r);
      ctx.arcTo(x,   y,   x+w, y,   r);
      ctx.closePath();
      if (fill) ctx.fill();
    }

    reset();
    step();
  })();
  </script>
</body>
</html>

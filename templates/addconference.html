<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Add Conference — Muniverse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}" type="image/png">
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" />
</head>
<body>
  <header class="topbar">
    <a class="logo" href="{{ url_for('feed') }}">
      <img class="logo-image" src="{{ url_for('static', filename='img/favicon.png') }}" alt="Muniverse Logo">
      <span>Muniverse</span>
    </a>
    <nav class="nav">
      <a class="active" href="{{ url_for('conferences') }}">Back to Conferences</a>
    </nav>
  </header>

  <main class="container narrow">
    <h2 class="section-title">Create a Conference</h2>
    <p class="muted">Submissions require admin approval and won’t appear immediately.</p>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flashes" style="margin:10px 0;">
          {% for category, message in messages %}
            <div class="flash flash-{{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form id="confForm" class="card form" action="{{ url_for('addconference') }}" method="POST" enctype="multipart/form-data">
      <div class="two-col">
        <label>Conference ID
          <input required name="id" placeholder="e.g., sodmun2025" pattern="^[a-z0-9\-]{3,40}$" />
          <small>Lowercase letters, numbers, dash</small>
        </label>
        <label>Name
          <input required name="name" placeholder="e.g., Summit of Diplomacy MUN 2025" />
        </label>
      </div>

      <div class="two-col">
        <label>Date
          <input required name="date" type="date" />
        </label>
        <label>Location
          <input required name="location" placeholder="City, Country" />
        </label>
      </div>

      <label>Description
        <textarea required name="description" rows="3" placeholder="Key councils, highlights, etc."></textarea>
      </label>

      <label>Upload banner
        <input id="bannerFile" type="file" name="banner_file" accept="image/png,image/jpeg,image/jpg,image/gif,image/webp" required />
        <small>Admins must approve before publication.</small>
      </label>

      <div id="previewWrap" class="card" style="display:none; padding:10px;">
        <div class="hero" style="border-radius:8px; overflow:hidden;">
          <img id="previewImg" alt="Banner preview" style="width:100%; height:auto; display:block;" />
        </div>
        <small id="previewMeta" class="muted"></small>
      </div>

      <label>Tags (comma-separated)
        <input name="tags" placeholder="#GA, #UNSC, #ECOSOC" />
      </label>

      <button class="btn btn-primary" type="submit">Submit for Approval</button>
    </form>
  </main>

  <script>
    (function () {
      const form = document.getElementById('confForm');
      const input = document.getElementById('bannerFile');
      const previewWrap = document.getElementById('previewWrap');
      const previewImg = document.getElementById('previewImg');
      const previewMeta = document.getElementById('previewMeta');
      const ALLOWED = ['png','jpg','jpeg','gif','webp'];
      const MAX_MB = 10;

      input.addEventListener('change', () => {
        const f = input.files && input.files[0];
        if (!f) { previewWrap.style.display = 'none'; return; }
        const ext = (f.name.split('.').pop() || '').toLowerCase();
        const okType = ALLOWED.includes(ext);
        const okSize = f.size <= MAX_MB * 1024 * 1024;
        if (!okType) { alert('Invalid file type. Allowed: ' + ALLOWED.join(', ')); input.value = ''; previewWrap.style.display='none'; return; }
        if (!okSize) { alert('File too large. Max ' + MAX_MB + 'MB.'); input.value = ''; previewWrap.style.display='none'; return; }
        const reader = new FileReader();
        reader.onload = e => { previewImg.src = e.target.result; previewWrap.style.display = ''; previewMeta.textContent = `${f.name} • ${(f.size/1024/1024).toFixed(2)} MB`; };
        reader.readAsDataURL(f);
      });

      form.addEventListener('submit', (e) => {
        if (!input.files || !input.files[0]) { e.preventDefault(); alert('Please choose a banner image.'); }
      });
    })();
  </script>
</body>
</html>

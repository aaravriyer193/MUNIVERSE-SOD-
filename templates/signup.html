<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Signup — Muniverse</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}" type="image/png">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet" />
</head>
<body>
    <header class="topbar">
        <a class="logo" href="{{ url_for('onboarding') }}">
            <img class="logo-image" src="{{ url_for('static', filename='img/favicon.png') }}" alt="Muniverse Logo">
            <span>Muniverse</span>
        </a>
    </header>

    <main class="container narrow">
        <h2 class="section-title">Create your profile</h2>

        {# This block displays server-side error messages from Flask (e.g., "Username taken") #}
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flashes">
            {% for category, message in messages %}
              <div class="flash flash-{{ category }}">{{ message }}</div>
            {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <form class="card form" id="signupForm" action="{{ url_for('signup') }}" method="POST" enctype="multipart/form-data">
            <div class="two-col">
                <div>
                    <label for="name-input">Full Name</label>
                    <input id="name-input" required name="name" placeholder="e.g., Jayson MUNs" />
                </div>
                <div>
                    <label for="username-input">Username</label>
                    <input id="username-input" required name="username" placeholder="e.g., aank" pattern="^[A-Za-z0-9_.\\-]{3,24}$" />
                    <small>3–24 chars, letters/numbers/._-</small>
                </div>
            </div>

            <div>
                <label for="school-input">School / Institution</label>
                <input id="school-input" required name="school" placeholder="e.g., Horizon International School" />
            </div>

            <div>
                <label for="bio-input">Short Bio</label>
                <textarea id="bio-input" required name="bio" rows="3" placeholder="Delegate, council interests, awards..."></textarea>
            </div>

            <div class="two-col">
                <div>
                    <label for="password-input">Password</label>
                    <input id="password-input" name="password" type="password" required minlength="6" placeholder="min 6 characters">
                </div>
                <div>
                    <label for="confirm-input">Confirm Password</label>
                    <input id="confirm-input" name="password_confirm" type="password" required minlength="6" placeholder="retype password">
                </div>
            </div>

            <div>
                <label for="photo-input">Profile photo (required)</label>
                <input id="photo-input" type="file" name="profile_photo" accept="image/*" required />
                <small>Please ensure all details are correct. The page will refresh if there are any mistakes.</small>
            </div>
  
                 <label class="form-check-label">
  <input type="checkbox" id="privacy-policy-agree" name="privacy_policy_agree" required>
  I agree with the <a href="{{ url_for('privacypolicy') }}" target="_blank">Privacy Policy</a>.
</label>

            <button class="btn btn-primary" type="submit">Join Muniverse</button>
        </form>
    </main>

    <script>
        document.getElementById("signupForm").addEventListener("submit", function(e) {
            const passwordInput = document.getElementById("password-input");
            const confirmInput = document.getElementById("confirm-input");

            // Check if passwords match. The browser handles other validations (required, pattern, etc.).
            if (passwordInput.value !== confirmInput.value) {
                alert("Passwords do not match.");
                e.preventDefault(); // Prevent form submission
                return;
            }
        });
    </script>
</body>
</html>